kind: pipeline
name: default

workspace:
  base: /packadd
  path: src/github.com/antoinedray/vim-packadd

steps:
- name: build
  image: python:latest
  commands:
  - python setup.py sdist

- name: install
  image: python:latest
  commands:
  - python setup.py install

- name: deploy
  image: python:latest
  environment:
    USERNAME:
      from_secret: username
    PASSWORD:
      from_secret: password
  commands:
  - pip install twine
  - python setup.py sdist
  - ls dist
  - twine upload dist/$(ls dist) -u $USERNAME -p $PASSWORD
  when:
    branch:
    - master